{% extends "layouts/base.html" %}

{% block content %}
<div class="card">
  <div class="card-body">
    <form 
      hx-post="/tokens/generate"
      hx-target="#tokens-list"
      hx-swap="innerHTML"
      class="form-inline"
    >
      <div class="form-group">
        <label for="name">Token Description (optional)</label>
        <input
          type="text"
          id="name"
          name="name"
          placeholder="e.g., workstation-01"
          class="form-control"
        >
      </div>
      <button type="submit" class="btn btn-primary">
        Generate Token
      </button>
    </form>
  </div>
</div>

{% if newToken %}
<div class="card card-highlight">
  <div class="card-header">
    <h2>ðŸŽ‰ New Token Generated</h2>
  </div>
  <div class="card-body">
    <p><strong>1. Install the agent:</strong></p>
    <div class="token-display">
      <code id="install-cmd">curl -fsSL https://raw.githubusercontent.com/SlavikCA/u-manager/master/install-agent.sh | sudo bash</code>
      <button
        class="btn btn-sm btn-secondary"
        onclick="copyText(document.getElementById('install-cmd').textContent, this)"
      >
        Copy
      </button>
    </div>

    <p><strong>2. Register with this server:</strong></p>
    <div class="token-display">
      <code id="register-cmd">sudo lum-agent --server-url {{ serverUrl }} --token {{ newToken.token }} --screenshots</code>
      <button
        class="btn btn-sm btn-secondary"
        onclick="copyText(document.getElementById('register-cmd').textContent, this)"
      >
        Copy
      </button>
    </div>

    <p class="text-muted">
      <strong>Note:</strong> The <code>--screenshots</code> flag is optional. This token can only be used once.
    </p>
  </div>
</div>
{% endif %}

<div class="card">
  <div class="card-header">
    <h2>All Tokens</h2>
  </div>
  
  <div id="tokens-list">
    {% include "partials/tokens-list.html" %}
  </div>
</div>
{% endblock %}
